# Класс Game

Класс `Game` выступает в качестве основы для инициализации и управления игрой, включая создание холста и контроль над сценами.

## Конструктор:

```javascript
new Game(width?: number, height?: number, canvasId?: string, displayErrors?: boolen, locale?: Locale);
```
Создаёт экземпляр игры с заданной шириной и высотой. 

**Параметры:**
* `width` (`number`, необязательно) — ширина игры. Если не указано, то ширина игры устанавливается равной ширине экрана.
* `height` (`number`, необязательно) — высота игры. Если не указано, то высота игры устанавливается равной высоте экрана.
* `canvasId` (`string`, необязательно) — ID элемента canvas в HTML. Если ID не указан, canvas создаётся автоматически.
* `displayErrors` (`boolean`, необязательно, по умолчанию `true`) — отображать ли ошибки.
* `locale` (`number`, необязательно, по умолчанию `ru`) — язык отображения ошибок.

## Основные свойства:

| Свойство         | Тип       | Описание                                                                                                           |
|------------------|-----------|--------------------------------------------------------------------------------------------------------------------|
| `width`          | `number`  | Ширина игры (canvas)                                                                                               |
| `height`         | `number`  | Высота игры (canvas)                                                                                               |
| `locale`         | `number`  | Язык отображения ошибок                                                                                            |
| `debugMode`      | `string`  | Режим отображения отладочной информации: `none` (выключено), `hover` (при наведении на объект), `forever` (всегда) |
| `debugCollider`  | `boolean` | Отображать ли коллайдеры                                                                                           |
| `debugColor`     | `string`  | Цвет отладочной информации                                                                                         |

## Содержание
*   [События](#события)
*   [Управление игрой](#управление-игрой)
*   [Размеры игры](#размеры-игры)
*   [Отладка](#отладка)
*   [Вспомогательные методы](#вспомогательные-методы)
*   [Отображение ошибок](#отображение-ошибок)
*   [Примеры использования](#примеры-использования)
*   [Общие рекомендации](#общие-рекомендации)


## События

Этот раздел описывает методы для управления событиями, связанными с игрой.

### Метод onReady()

```javascript
onReady(callback: CallableFunction): void
```

Регистрирует функцию обратного вызова, которая будет выполнена, когда игра будет готова к запуску.

**Параметры:**

* `callback` (`CallableFunction`) - Функция, которая будет выполнена после подготовки игры.

**Описание:**

Добавляет функцию обратного вызова в список функций, которые будут вызваны, когда игра будет готова к использованию (т.е. когда загружены все необходимые ресурсы для всех сцен).

**Пример использования:**

```javascript
game.onReady(() => {
    console.log('Игра готова к запуску!');
    game.run();
});
```

## Управление игрой

Этот раздел описывает методы для управления жизненным циклом игры, сценами и общими состояниями.

### Метод run()

```javascript
run(stage: Stage = null): void
```

Запускает игру на указанной сцене.

**Параметры:**

* `stage` (`Stage`, необязательно) - Сцена для запуска. Если не указана, используется первая сцена из списка сцен игры.

**Описание:**

Запускает игру на указанной сцене. Если сцена не указана, пытается использовать первую сцену из списка. Если список сцен пуст, генерирует ошибку. Перед запуском останавливает текущую активную сцену, если она есть.

**Пример использования:**

```javascript
const stage = new Stage();
game.run(stage); // Запустить игру на новой сцене
```

---

### Метод stop()

```javascript
stop(): void
```

Останавливает игру.

**Описание:**

Останавливает текущую активную сцену, если она запущена, и устанавливает флаг `running` в `false`.

**Пример использования:**

```javascript
game.stop(); // Остановить игру
```

---

### Метод isReady()

```javascript
isReady(): boolean
```

Возвращает значение, показывающее, готова ли игра к запуску.

**Возвращаемое значение:**

* (`boolean`) - `true`, если игра готова, `false` - в противном случае.

**Описание:**

Проверяет, загружены ли все сцены и готова ли игра к запуску.

**Пример использования:**

```javascript
if (game.isReady()) {
    game.run();
} else {
    console.log('Игра еще не готова к запуску.');
}
```

---

### Метод getActiveStage()

```javascript
getActiveStage(): Stage | null
```

Возвращает активную сцену игры.

**Возвращаемое значение:**

* (`Stage | null`) - Активная сцена или `null`, если активная сцена не задана.

**Описание:**

Возвращает текущую активную сцену игры. Если активная сцена не задана, возвращает `null`.

**Пример использования:**

```javascript
const activeStage = game.getActiveStage();
if (activeStage) {
    console.log('Активная сцена: ' + activeStage.name);
} else {
    console.log('Активная сцена не задана.');
}
```

## Размеры игры

Этот раздел описывает свойства, определяющие различные параметры игры.

### Свойство width

```javascript
get width(): number
```

Возвращает ширину canvas, используемого игрой.

**Возвращаемое значение:**

* (`number`) - ширина canvas в пикселях.

**Описание:**

Возвращает текущую ширину canvas, на котором отображается игра.

**Пример использования:**

```javascript
const gameWidth = game.width;
console.log(`Ширина игры: ${gameWidth}`);
```

---

### Свойство height

```javascript
get height(): number
```

Возвращает высоту canvas, используемого игрой.

**Возвращаемое значение:**

* (`number`) - высота canvas в пикселях.

**Описание:**

Возвращает текущую высоту canvas, на котором отображается игра.

**Пример использования:**

```javascript
const gameHeight = game.height;
console.log(`Высота игры: ${gameHeight}`);
```

## Отладка

Этот раздел описывает свойства, используемые для отладки игры.

### Свойство debugMode

Определяет режим отладки.

**Возможные значения:**

* `'none'` - Режим отладки отключен.
* `'hover'` - Режим отладки активируется при наведении курсора мыши на спрайт.
* `'forever'` - Режим отладки включен постоянно.

**Описание:**

Управляет режимом отладки игры. В зависимости от выбранного режима, может отображаться дополнительная информация о спрайтах.

**Пример использования:**

```javascript
game.debugMode = 'hover'; // Включить режим отладки при наведении мыши
```

---

### Свойство debugCollider

Определяет, должны ли отображаться коллайдеры спрайтов.

**Возвращаемое значение:**

* (`boolean`) - `true`, если коллайдеры должны отображаться, `false` - в противном случае.

**Описание:**

Управляет отображением коллайдеров спрайтов в режиме отладки.

**Пример использования:**

```javascript
game.debugCollider = true; // Отображать коллайдеры спрайтов
```

---

### Свойство debugColor

Определяет цвет отладочной информации (например, коллайдеров).

**Возвращаемое значение:**

* (`string`) - Строка, представляющая цвет в формате CSS (например, `'red'`, `'#FF0000'`, `'rgb(255, 0, 0)'`).

**Описание:**

Устанавливает цвет, используемый для отображения отладочной информации, такой как границы коллайдеров.

**Пример использования:**

```javascript
game.debugColor = 'blue'; // Установить синий цвет для отладочной информации
```

## Вспомогательные методы

Этот раздел описывает вспомогательные методы, предоставляющие полезные функции для работы с игрой.

### Метод keyPressed()

```javascript
keyPressed(char: string): boolean
```

Проверяет, нажата ли указанная клавиша.

**Параметры:**

* `char` (`string`) - Символ клавиши (например, "a", "space", "enter").

**Возвращаемое значение:**

* (`boolean`) - `true`, если клавиша нажата, `false` - в противном случае.

**Описание:**

Определяет, находится ли указанная клавиша в состоянии нажатия.

**Пример использования:**

```javascript
if (game.keyPressed('a')) {
    console.log('Клавиша A нажата!');
}
```

---

### Метод keyDown()

```javascript
keyDown(char: string, callback: CallableFunction): void
```

Регистрирует функцию обратного вызова, которая будет выполнена при нажатии указанной клавиши.

**Параметры:**

* `char` (`string`) - Символ клавиши (например, "a", "space", "enter").
* `callback` (`CallableFunction`) - Функция, которая будет выполнена при нажатии клавиши.

**Описание:**

Добавляет функцию обратного вызова, которая будет вызвана при каждом нажатии указанной клавиши.

**Пример использования:**

```javascript
game.keyDown('space', () => {
    console.log('Нажата клавиша Space!');
});
```

---

### Метод keyUp()

```javascript
keyUp(char: string, callback: CallableFunction): void
```

Регистрирует функцию обратного вызова, которая будет выполнена при отпускании указанной клавиши.

**Параметры:**

* `char` (`string`) - Символ клавиши (например, "a", "space", "enter").
* `callback` (`CallableFunction`) - Функция, которая будет выполнена при отпускании клавиши.

**Описание:**

Добавляет функцию обратного вызова, которая будет вызвана при каждом отпускании указанной клавиши.

**Пример использования:**

```javascript
game.keyUp('a', () => {
    console.log('Отпущена клавиша A!');
});
```

---

### Метод mouseDown()

```javascript
mouseDown(): boolean
```

Проверяет, нажата ли кнопка мыши.

**Возвращаемое значение:**

* (`boolean`) - `true`, если кнопка мыши нажата, `false` - в противном случае.

**Описание:**

Определяет, находится ли кнопка мыши в состоянии нажатия на активной сцене.

**Пример использования:**

```javascript
if (game.mouseDown()) {
    console.log('Кнопка мыши нажата!');
}
```

---

### Метод mouseDownOnce()

```javascript
mouseDownOnce(): boolean
```

Проверяет, была ли нажата кнопка мыши один раз.

**Возвращаемое значение:**

* (`boolean`) - `true`, если кнопка мыши была нажата один раз, `false` - в противном случае.

**Описание:**

Определяет, была ли кнопка мыши нажата и сразу отпущена. Этот метод сбрасывает состояние кнопки мыши, чтобы предотвратить повторные срабатывания.

**Пример использования:**

```javascript
if (game.mouseDownOnce()) {
    console.log('Кнопка мыши была нажата один раз!');
}
```

---

### Метод getMousePoint()

```javascript
getMousePoint(): PointCollider
```

Возвращает объект, представляющий положение мыши.

**Возвращаемое значение:**

* (`PointCollider`) - Объект, представляющий положение мыши.

**Описание:**

Возвращает объект `PointCollider`, содержащий координаты мыши на активной сцене.

**Пример использования:**

```javascript
const mousePoint = game.getMousePoint();
console.log(`Координаты мыши: X=${mousePoint.x}, Y=${mousePoint.y}`);
```

---

### Метод getRandom()

```javascript
getRandom(min: number, max: number): number
```

Возвращает случайное целое число в заданном диапазоне.

**Параметры:**

* `min` (`number`) - Минимальное значение диапазона.
* `max` (`number`) - Максимальное значение диапазона.

**Возвращаемое значение:**

* (`number`) - Случайное целое число в диапазоне от `min` до `max` (включительно).

**Описание:**

Генерирует случайное целое число в указанном диапазоне.

**Пример использования:**

```javascript
const randomNumber = game.getRandom(1, 10);
console.log(`Случайное число: ${randomNumber}`);
```

---

### Метод isInsideGame()

```javascript
isInsideGame(x: number, y: number): boolean
```

Проверяет, находятся ли указанные координаты внутри игрового поля.

**Параметры:**

* `x` (`number`) - Координата X.
* `y` (`number`) - Координата Y.

**Возвращаемое значение:**

* (`boolean`) - `true`, если координаты находятся внутри игрового поля, `false` - в противном случае.

**Описание:**

Определяет, находятся ли указанные координаты внутри границ игрового поля, заданных шириной и высотой игры.

**Пример использования:**

```javascript
const isInside = game.isInsideGame(100, 150);
console.log(`Координаты внутри игрового поля: ${isInside}`);
```

## Отображение ошибок

Отображение ошибок особенно полезно во время разработки проекта. Алгоритм может подсказывать правильные названия методов даже при опечатках. Однако это создаёт дополнительную нагрузку, поскольку для проверки корректности используются специальные прокси-объекты.

Когда игра готова к релизу, рекомендуется отключить отображение ошибок для повышения производительности.

## Примеры использования

### Инициализация игры:

```javascript
// Игра во весь экран с отображением ошибок
const game = new Game();

// Игра размером 480 на 320 пикселей с отображением ошибок
const game = new Game(480, 320);

// Релизный вариант: игра 480x320 пикселей без отображения ошибок
const game = new Game(480, 320, null, false);
```

### Запуск и остановка игры:

```javascript

// Запустить игру с первой добавленной сценой
game.run();

// Запустить игру с конкретной сценой
game.run(gameStage);

// Остановить через 10 секунд
setTimeout(() => {
    game.stop();
}, 10000);
```

### Включение режима отладки:

```javascript
const game = new Game();
game.debugMode = 'forever';     // Отображать отладочную информацию постоянно
game.debugCollider = true;      // Показывать коллайдеры
game.debugColor = 'black';      // Цвет информации и коллайдеров — чёрный
```

### Работа с клавишами и мышью:

```javascript
game.keyDown('space', () => {
    console.log('Нажата клавиша пробел');
});

game.keyUp('space', () => {
    console.log('Пробел отпущен');
});

stage.forever(() => {
    if (game.keyPressed('w')) {
        console.log('Клавиша W нажата!');
    }
    
    if (game.mouseDownOnce()) {
        console.log('Щелчок мышью!');
    }

    console.log('Координаты мыши: ' + game.getMousePoint());
});

console.log('Случайное число от 1 до 10 включительно: ' + game.getRandom(1, 10));
```

### Событие готовности:

```javascript
game.onReady(() => {
    console.log('Игра готова!');
});
```

## Общие рекомендации

Обратите внимание: метод `run()` следует вызывать в конце программы, после создания и настройки сцен и спрайтов. Только после этого можно запускать игру.
